<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Kontrat / Pozisyon Büyüklüğü Hesaplayıcı</title>
  <style>
    :root{--bg:#0f1724;--card:#0b1220;--accent:#06b6d4;--muted:#94a3b8;--glass:rgba(255,255,255,0.03)}
    body{font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,'Helvetica Neue',Arial;margin:0;background:linear-gradient(180deg,#071028 0%, #041028 100%);color:#e6eef6;}
    .wrap{max-width:980px;margin:32px auto;padding:24px;background:var(--card);border-radius:12px;box-shadow:0 10px 30px rgba(2,6,23,0.6)}
    h1{margin:0 0 10px;font-size:20px}
    p.lead{color:var(--muted);margin-top:0}
    .grid{display:grid;grid-template-columns:repeat(2,1fr);gap:14px;margin-top:18px}
    .full{grid-column:1/-1}
    label{display:block;font-size:13px;color:var(--muted);margin-bottom:6px}
    input[type=number],select,input[type=text]{width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:var(--glass);color:inherit}
    .row{display:flex;gap:8px}
    button{background:var(--accent);color:#042;padding:10px 14px;border:none;border-radius:8px;cursor:pointer}
    .result{margin-top:18px;padding:14px;border-radius:10px;background:linear-gradient(180deg, rgba(6,8,20,0.6), rgba(6,8,20,0.4));border:1px solid rgba(255,255,255,0.03)}
    .muted{color:var(--muted);font-size:13px}
    .small{font-size:13px}
    .note{margin-top:10px;color:#c9d6e6}
    code{background:rgba(255,255,255,0.03);padding:4px 6px;border-radius:6px}
    @media (max-width:760px){.grid{grid-template-columns:1fr}}
  </style>
</head>
<body>
  <main class="wrap">
    <h1>Kontrat / Pozisyon Büyüklüğü Hesaplayıcı</h1>
    <p class="lead">Forex (EUR/USD vb.) veya endeks/CFD (NASDAQ vb.) için pozisyon büyüklüğü hesaplar. Varsayılan değerler <strong>USD hesap</strong> içindir — farklı hesap para biriminiz varsa pip/tick değerini el ile güncelleyin.</p>

    <div class="grid">
      <div>
        <label>Hesap Para Birimi</label>
        <select id="accountCurrency">
          <option>USD</option>
          <option>EUR</option>
          <option>TRY</option>
        </select>
      </div>

      <div>
        <label>Hesap Bakiyesi (<span id="accCurLabel">USD</span>)</label>
        <input id="accountBalance" type="number" inputmode="decimal" step="0.01" value="10000" />
      </div>

      <div>
        <label>Risk (%) — hesap bakiyesine göre</label>
        <input id="riskPercent" type="number" step="0.01" value="1" />
      </div>

      <div>
        <label>Giriş Fiyatı (isteğe bağlı, sadece bilgi amaçlı)</label>
        <input id="entryPrice" type="number" step="0.0001" placeholder="örn. 1.1200" />
      </div>

      <div>
        <label>Stop Loss (pips/points)</label>
        <input id="stopLoss" type="number" step="0.01" value="50" />
      </div>

      <div>
        <label>Enstrüman Türü</label>
        <select id="instrumentType">
          <option value="forex">Forex (pip-based)</option>
          <option value="index">Endeks / CFD (point/tick-based)</option>
          <option value="custom">Özel (elle değer girin)</option>
        </select>
      </div>

      <div id="forexBlock" class="full">
        <label>Forex çifti (presetler, pip değeri otomatik doldurulur ama değiştirilebilir)</label>
        <div class="row">
          <select id="forexPair">
            <option value="EURUSD">EUR/USD</option>
            <option value="GBPUSD">GBP/USD</option>
            <option value="USDJPY">USD/JPY</option>
            <option value="EURGBP">EUR/GBP</option>
          </select>
          <input id="pipValue" type="number" step="0.0001" placeholder="Pip değeri (1 std lot için)" />
        </div>
        <div class="muted small">Not: "Pip değeri" alanı 1 standart lot (100.000 birim) için pip/tick değeri içindir ve varsayılanlar <strong>USD hesabı</strong> içindir. Farklı hesap para birimleri veya broker sözleşme büyüklükleri için değeri el ile düzeltin.</div>
      </div>

      <div id="indexBlock" class="full" style="display:none;">
        <label>Endeks / CFD (ör. NASDAQ) - preset</label>
        <div class="row">
          <select id="indexSelect">
            <option value="NASDAQ">NASDAQ (US100) — varsayılan tick değer: 1</option>
            <option value="SP500">S&P 500 (US500) — varsayılan tick değer: 1</option>
            <option value="DOW">DOW (US30) — varsayılan tick değer: 1</option>
          </select>
          <input id="pointValue" type="number" step="0.0001" placeholder="Point değeri / kontrat (hesap para birimi)" />
        </div>
        <div class="muted small">Not: Endekslerde kontrat başına puan değeri brokera göre değişir. Buradaki varsayılanlar genel bir örnektir; kesin değer için broker sözleşmenize bakın.</div>
      </div>

      <div id="customBlock" class="full" style="display:none;">
        <label>Özel: Kontrat / lot büyüklüğü ve pip/tick değeri</label>
        <div class="grid">
          <div>
            <label>1 lot / kontrat kaç birim? (örn. Forex için 100000)</label>
            <input id="lotSize" type="number" step="1" value="100000" />
          </div>
          <div>
            <label>Pip / point değeri (1 standart lot için, hesap para birimi)</label>
            <input id="customPipValue" type="number" step="0.0001" value="10" />
          </div>
        </div>
      </div>

      <div class="full">
        <label>Kaldıraç (isteğe bağlı, sadece marj hesaplaması için)</label>
        <input id="leverage" type="number" step="1" value="30" />
      </div>

      <div class="full row" style="justify-content:flex-end;margin-top:6px">
        <button id="calcBtn">Hesapla</button>
        <button id="resetBtn" style="background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted);">Sıfırla</button>
      </div>

    </div>

    <section class="result" id="resultBox" style="display:none">
      <h2>Sonuçlar</h2>
      <div id="results"></div>
      <div class="note">Açıklama: Hesaplamalar girilen <strong>pip/point değeri</strong> ve <strong>lot/kontrat büyüklüğü</strong> baz alınarak yapılır. Broker sözleşme şartları farklılık gösterdiğinden özellikle NASDAQ, US30, US500 vb. için brokerinizin "contract specification" sayfasındaki değerleri kullanın.</div>
      <div style="margin-top:10px"><button id="copyBtn">Sonuçları Kopyala</button></div>
    </section>
  </main>

  <script>
    // Elementler
    const accountCurrency = document.getElementById('accountCurrency');
    const accCurLabel = document.getElementById('accCurLabel');
    const accountBalance = document.getElementById('accountBalance');
    const riskPercent = document.getElementById('riskPercent');
    const stopLoss = document.getElementById('stopLoss');
    const instrumentType = document.getElementById('instrumentType');
    const forexBlock = document.getElementById('forexBlock');
    const indexBlock = document.getElementById('indexBlock');
    const customBlock = document.getElementById('customBlock');
    const forexPair = document.getElementById('forexPair');
    const pipValue = document.getElementById('pipValue');
    const indexSelect = document.getElementById('indexSelect');
    const pointValue = document.getElementById('pointValue');
    const lotSize = document.getElementById('lotSize');
    const customPipValue = document.getElementById('customPipValue');
    const calcBtn = document.getElementById('calcBtn');
    const resetBtn = document.getElementById('resetBtn');
    const resultBox = document.getElementById('resultBox');
    const results = document.getElementById('results');
    const copyBtn = document.getElementById('copyBtn');
    const leverage = document.getElementById('leverage');

    // Preset doldurmalar (varsayılanlar USD hesabı içindir)
    function fillPipDefaults(){
      const pair = forexPair.value;
      if(pair === 'EURUSD' || pair === 'GBPUSD' || pair === 'EURGBP'){
        pipValue.value = 10; // 1 standart lot için pip değeri yaklaşık 10 USD
      } else if(pair === 'USDJPY'){
        pipValue.value = 9.13; // yaklaşık değer (hesap USD sayılır)
      } else {
        pipValue.value = 10;
      }
    }

    function fillIndexDefaults(){
      const idx = indexSelect.value;
      if(idx === 'NASDAQ'){
        pointValue.value = 1; // broker'a göre değişir — genelde 1 USD/point örnek
      } else if(idx === 'SP500'){
        pointValue.value = 1;
      } else if(idx === 'DOW'){
        pointValue.value = 1;
      }
    }

    // Eventler
    forexPair.addEventListener('change', fillPipDefaults);
    indexSelect.addEventListener('change', fillIndexDefaults);
    accountCurrency.addEventListener('change', ()=>{accCurLabel.textContent = accountCurrency.value});

    instrumentType.addEventListener('change', ()=>{
      const t = instrumentType.value;
      forexBlock.style.display = t === 'forex' ? 'block' : 'none';
      indexBlock.style.display = t === 'index' ? 'block' : 'none';
      customBlock.style.display = t === 'custom' ? 'block' : 'none';
    });

    resetBtn.addEventListener('click', (e)=>{
      e.preventDefault();
      accountBalance.value = 10000; riskPercent.value = 1; stopLoss.value = 50; pipValue.value = 10; lotSize.value = 100000; customPipValue.value = 10; pointValue.value = 1; leverage.value = 30; entryPrice.value = '';
      resultBox.style.display = 'none';
    });

    // Hesaplama fonksiyonu
    calcBtn.addEventListener('click', (e)=>{
      e.preventDefault();
      // Girdi doğrulama
      const bal = parseFloat(accountBalance.value);
      const riskP = parseFloat(riskPercent.value);
      const sl = parseFloat(stopLoss.value);
      if(isNaN(bal) || bal <= 0){ alert('Geçerli bir hesap bakiyesi girin'); return; }
      if(isNaN(riskP) || riskP <= 0){ alert('Geçerli bir risk yüzdesi girin'); return; }
      if(isNaN(sl) || sl <= 0){ alert('Geçerli bir stop loss değeri girin'); return; }

      const riskAmount = bal * (riskP/100);
      let lots = 0, units = 0, pipVal = 0, usedLotSize = 0, margin = null;

      if(instrumentType.value === 'forex'){
        pipVal = parseFloat(pipValue.value);
        if(isNaN(pipVal) || pipVal <= 0){ alert('Geçerli bir pip değeri girin'); return; }
        usedLotSize = parseFloat(lotSize.value) || 100000;
        // lot sayısı = risk / (stopLoss * pipValuePerLot)
        lots = riskAmount / (sl * pipVal);
        units = lots * usedLotSize;
        // marj yaklaşık: (entryPrice * units) / leverage — entryPrice zorunlu değil
        const ep = parseFloat(document.getElementById('entryPrice').value);
        if(!isNaN(ep) && ep > 0){ margin = (ep * units) / (parseFloat(leverage.value)||1); }

      } else if(instrumentType.value === 'index'){
        pipVal = parseFloat(pointValue.value);
        if(isNaN(pipVal) || pipVal <= 0){ alert('Geçerli bir point değeri girin'); return; }
        // index kontratları genelde 1 kontrat başına x USD/point. Burada "lot" yerine kontrat sayısı hesaplanır.
        const contracts = riskAmount / (sl * pipVal);
        lots = contracts; // semantik olarak kontrat sayısı
        units = contracts; // kontrat sayısı
        const ep = parseFloat(document.getElementById('entryPrice').value);
        if(!isNaN(ep) && ep > 0){ margin = (ep * contracts) / (parseFloat(leverage.value)||1); }

      } else {
        // custom
        pipVal = parseFloat(customPipValue.value);
        usedLotSize = parseFloat(lotSize.value) || 1;
        if(isNaN(pipVal) || pipVal <= 0){ alert('Geçerli bir pip/point değeri girin (custom)'); return; }
        const l = riskAmount / (sl * pipVal);
        lots = l;
        units = l * usedLotSize;
        const ep = parseFloat(document.getElementById('entryPrice').value);
        if(!isNaN(ep) && ep > 0){ margin = (ep * units) / (parseFloat(leverage.value)||1); }
      }

      // Yuvarlama ve gösterim
      const displayLots = Number.isFinite(lots) ? Math.max(0, lots) : 0;
      const displayUnits = Number.isFinite(units) ? Math.max(0, units) : 0;

      resultBox.style.display = 'block';
      results.innerHTML = `
        <p><strong>Risk Tutarı:</strong> ${riskAmount.toLocaleString(undefined,{minimumFractionDigits:2,maximumFractionDigits:2})} ${accountCurrency.value}</p>
        <p><strong>Önerilen Pozisyon (lot / kontrat):</strong> ${displayLots.toFixed(4)}</p>
        <p><strong>Birimsel Büyüklük (adet / kontrat sayısı):</strong> ${displayUnits.toLocaleString(undefined,{maximumFractionDigits:2})}</p>
        <p class="muted">Kullanılan pip/point değeri (1 standart lot/kontrat için): ${pipVal} ${accountCurrency.value}</p>
        ${margin !== null ? `<p><strong>Yaklaşık Gerekli Marj:</strong> ${margin.toLocaleString(undefined,{minimumFractionDigits:2,maximumFractionDigits:2})} ${accountCurrency.value} (kaldıraç ${leverage.value}:1 ile)</p>` : ''}
      `;
    });

    copyBtn.addEventListener('click', ()=>{
      const text = results.innerText || results.textContent;
      navigator.clipboard.writeText(text).then(()=>{
        copyBtn.textContent = 'Kopyalandı!';
        setTimeout(()=>copyBtn.textContent='Sonuçları Kopyala',900);
      }).catch(()=>{ alert('Kopyalama başarısız'); });
    });

    // İlk varsayılan doldurma
    fillPipDefaults(); fillIndexDefaults();
  </script>
</body>
</html>
